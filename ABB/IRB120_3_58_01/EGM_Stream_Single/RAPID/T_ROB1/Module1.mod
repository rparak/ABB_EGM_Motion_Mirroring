MODULE Module1
    ! Targets
    CONST robtarget Target_10:=[[263.321960449,-68.978512397,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_20:=[[263.321960449,-155.446746826,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_30:=[[463.321960449,-155.446746826,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_40:=[[463.321960449,144.553253174,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_50:=[[320.448416208,144.553253174,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_60:=[[323.349310221,127.995106698,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_70:=[[320.59851418,111.411363998,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_80:=[[312.506964207,96.676567771,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_90:=[[299.98928833,85.456265126,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_100:=[[299.98928833,22.036067079,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_110:=[[318.046831052,14.718242482,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_120:=[[331.936397486,1.05422586,300],[0,-0.707106781,0.707106781,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_130:=[[339.548854715,-16.881099643,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_140:=[[339.728249872,-36.364251938,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_150:=[[332.447341773,-54.436711185,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_160:=[[318.811737495,-68.354171512,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_170:=[[300.892005763,-76.003264309,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_180:=[[281.40926075,-76.222473592,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_190:=[[263.321960449,-68.978512397,300],[0,-0.707106781,0.707106781,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_20_2:=[[263.321960449,-155.446746826,300],[0,-0.382683433,0.923879532,0],[-1,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_30_2:=[[463.321960449,-155.446746826,300],[0,0.923879532,-0.382683433,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_40_2:=[[463.321960449,144.553253174,300],[0,0.923879533,0.382683431,0],[0,0,-3,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_50_2:=[[320.448416208,144.553253174,300],[0,-0.608761429,0.79335334,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_60_2:=[[323.349310221,127.995106698,300],[0,-0.5,0.866025404,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_70_2:=[[320.59851418,111.411363998,300],[0,-0.382683432,0.923879533,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_80_2:=[[312.506964207,96.676567771,300],[0,-0.258819045,0.965925826,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_90_2:=[[299.98928833,85.456265126,300],[0,-0.130526192,0.991444861,0],[0,0,0,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_100_2:=[[299.98928833,22.036067079,300],[0,0.923879533,0.382683432,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_110_2:=[[318.046831052,14.718242482,300],[0,0.965925826,0.258819045,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_120_2:=[[331.936397486,1.05422586,300],[0,0.991444861,0.130526192,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_130_2:=[[339.548854715,-16.881099643,300],[0,1,0,0],[-1,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_140_2:=[[339.728249872,-36.364251938,300],[0,0.991444861,-0.130526192,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_150_2:=[[332.447341773,-54.436711185,300],[0,0.965925826,-0.258819045,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_160_2:=[[318.811737495,-68.354171512,300],[0,0.923879533,-0.382683432,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_170_2:=[[300.892005763,-76.003264309,300],[0,0.866025404,-0.5,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_180_2:=[[281.40926075,-76.222473592,300],[0,0.79335334,-0.608761429,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_190_2:=[[263.321960449,-68.978512397,300],[0,-0.707106781,0.707106781,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_10_2_2:=[[263.321960449,-68.978512397,300],[0.092295956,-0.701057385,0.701057385,-0.092295956],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_20_2_2:=[[263.321960449,-155.446746826,300],[0.092295956,-0.701057385,0.701057385,-0.092295956],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_20_2_2_2:=[[263.321960449,-155.446746826,300],[0,-0.382683433,0.923879532,0],[-1,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_30_2_2:=[[463.321960449,-155.446746826,300],[0,0.923879532,-0.382683433,0],[-1,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_30_2_2_2:=[[463.321960449,-155.446746826,300],[0.037109679,0.916827972,-0.387892623,-0.087112884],[-1,-1,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_40_2_2:=[[463.321960449,144.553253174,300],[0.037109679,0.916827972,-0.387892623,-0.087112884],[0,0,-2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_40_2_2_2:=[[463.321960449,144.553253174,300],[0,0.923879533,0.382683431,0],[0,0,-3,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_50_2_2:=[[320.448416208,144.553253174,300],[0,-0.608761429,0.79335334,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_50_2_2_2:=[[320.448416208,144.553253174,300],[0,-0.608761429,0.79335334,0],[0,-1,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_60_2_2:=[[323.349310221,127.995106698,300],[0,-0.5,0.866025404,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_70_2_2:=[[320.59851418,111.411363998,300],[0,-0.382683432,0.923879533,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_80_2_2:=[[312.506964207,96.676567771,300],[0,-0.258819045,0.965925826,0],[0,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_90_2_2:=[[299.98928833,85.456265126,300],[0,-0.130526192,0.991444861,0],[0,0,0,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_100_2_2:=[[299.98928833,22.036067079,300],[0,0.923879533,0.382683432,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_110_2_2:=[[318.046831052,14.718242482,300],[0,0.965925826,0.258819045,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_120_2_2:=[[331.936397486,1.05422586,300],[0,0.991444861,0.130526192,0],[0,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_130_2_2:=[[339.548854715,-16.881099643,300],[0,1,0,0],[-1,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_140_2_2:=[[339.728249872,-36.364251938,300],[0,0.991444861,-0.130526192,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_150_2_2:=[[332.447341773,-54.436711185,300],[0,0.965925826,-0.258819045,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_160_2_2:=[[318.811737495,-68.354171512,300],[0,0.923879533,-0.382683432,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_170_2_2:=[[300.892005763,-76.003264309,300],[0,0.866025404,-0.5,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_180_2_2:=[[281.40926075,-76.222473592,300],[0,0.79335334,-0.608761429,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    CONST robtarget Target_190_2_3:=[[263.321960449,-68.978512397,300],[0,-0.707106781,0.707106781,0],[-1,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];

    ! Home position
    LOCAL CONST robtarget Target_Home:=[[302,0.0,558.0],[0,0,1,0],[-1,0,-1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
    ! Identifier for the EGM correction
    LOCAL VAR egmident egm_id;
    
    ! Actual State {Main State-Machine)
    VAR num actual_state := 0;
    
    ! Initialization Parameters
    CONST num speed_tcp    := 40;
    CONST num speed_orient := 40;
    VAR speeddata speed_value := [speed_tcp,speed_orient,0,0];
    VAR zonedata zone_value   := z0;
    
    ! Description:                                          !
    ! Simple movements with EGM Streaming Pos. - Main Cycle !
    PROC Main()
        TEST actual_state
            CASE 0:
                ! Register an EGM id
                EGMGetId egm_id;
                ! Setup the EGM communication
                EGMSetupUC ROB_1, egm_id, "default", "ROB_1";
                ! Start the EGM communication session
                EGMStreamStart egm_id \SampleRate:=4;
                actual_state := 1; 
            CASE 1:
                ! Move to the starting position
                !MoveJ Target_10,v50,fine,tool0\WObj:=wobj0;
                
                ! Instructions for multiple movements
                Path_Experiment_1_T1 speed_value, zone_value;
                actual_state := 2;
            CASE 2:
                ! Empty
        ENDTEST
                
        ! Stop and Release the EGM id
        !EGMStreamStop egm_id;
        !EGMReset egm_id;
    ENDPROC
    
    PROC Path_Experiment_1_T1(speeddata speed, zonedata zone)
        MoveL Target_20,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_30,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_40,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_50,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_60,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_70,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_80,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_90,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_100,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_110,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_120,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_130,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_140,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_150,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_160,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_170,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_180,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_190,speed,fine,tool0\WObj:=wobj0;
    ENDPROC
    
    PROC Path_Experiment_1_T2(speeddata speed, zonedata zone)
        MoveL Target_20_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_30_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_40_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_50_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_60_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_70_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_80_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_90_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_100_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_110_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_120_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_130_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_140_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_150_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_160_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_170_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_180_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_190_2,speed,zone,tool0\WObj:=wobj0;
        MoveJ Target_190,speed,fine,tool0\WObj:=wobj0;
    ENDPROC
    
    PROC Path_Experiment_1_T3(speeddata speed, zonedata zone)
        MoveL Target_10_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_20_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_20_2_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_30_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_30_2_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_40_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_40_2_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_50_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_60_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_70_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_80_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_90_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_100_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_110_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_120_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_130_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_140_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_150_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_160_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_170_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_180_2_2,speed,zone,tool0\WObj:=wobj0;
        MoveL Target_190_2_3,speed,zone,tool0\WObj:=wobj0;
        MoveJ Target_190,speed,fine,tool0\WObj:=wobj0;
    ENDPROC
ENDMODULE